<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Reader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #pdfContainer {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            overflow: auto;
            position: relative;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
        #controls {
            margin: 10px 0;
        }
    </style>
    <!-- Include PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
</head>
<body>
    <h1>PDF Reader</h1>
    <input type="text" id="pdfUrl" placeholder="Enter PDF URL" />
    <input type="file" id="pdfFile" accept="application/pdf" />
    <button id="loadPdf">Load PDF from URL</button>
    <div id="message"></div>
    <div id="pdfContainer"></div>
    <div id="controls">
        <button id="prev">Previous</button>
        <button id="next">Next</button>
    </div>

    <script>
        let pdfDoc = null;
        let currentPage = 1;
        const pdfContainer = document.getElementById('pdfContainer');
        const messageDiv = document.getElementById('message');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const pdfFileInput = document.getElementById('pdfFile');
        const loadPdfButton = document.getElementById('loadPdf');
        const pdfUrlInput = document.getElementById('pdfUrl');

        // Load PDF from URL
        loadPdfButton.addEventListener('click', async () => {
            const pdfUrl = pdfUrlInput.value;
            messageDiv.textContent = '';
            pdfContainer.innerHTML = '';

            const extractedUrl = extractPdfUrl(pdfUrl);
            if (!extractedUrl) {
                messageDiv.textContent = 'Invalid URL. Please enter a valid PDF URL.';
                return;
            }

            const allOriginsUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(extractedUrl)}`;

            try {
                const response = await fetch(allOriginsUrl);
                const data = await response.json();

                if (data && data.contents) {
                    const pdfData = data.contents;
                    loadPdf(pdfData);
                    messageDiv.textContent = 'PDF loaded successfully!';
                } else {
                    throw new Error('Failed to load PDF content.');
                }
            } catch (error) {
                messageDiv.textContent = `Error: ${error.message}`;
            }
        });

        // Load PDF from file
        pdfFileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                const fileReader = new FileReader();
                fileReader.onload = async function() {
                    const pdfData = new Uint8Array(this.result);
                    loadPdf(pdfData);
                };
                fileReader.readAsArrayBuffer(file);
                messageDiv.textContent = 'Loading PDF...';
            } else {
                messageDiv.textContent = 'Please upload a valid PDF file.';
            }
        });

        async function loadPdf(pdfData) {
            try {
                pdfDoc = await pdfjsLib.getDocument(pdfData).promise;
                currentPage = 1;
                renderPage(currentPage);
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage >= pdfDoc.numPages;
            } catch (error) {
                messageDiv.textContent = `Error loading PDF: ${error.message}`;
            }
        }

        async function renderPage(pageNum) {
            const page = await pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale: 1.5 });
            pdfContainer.innerHTML = ''; // Clear previous pages

            const canvas = document.createElement('canvas');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            pdfContainer.appendChild(canvas);

            const context = canvas.getContext('2d');
            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };

            await page.render(renderContext).promise;

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage >= pdfDoc.numPages;
        }

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < pdfDoc.numPages) {
                currentPage++;
                renderPage(currentPage);
            }
        });

        function extractPdfUrl(url) {
            // Use a regex to extract the URL from Google redirect links
            const regex = /url=([^&]+)/;
            const match = url.match(regex);
            return match ? decodeURIComponent(match[1]) : null;
        }
    </script>
</body>
</html>
